import { preloadImages } from "../../libs/utils.js";
import { scrollToTop } from "../../js/index/global.js";
$ = jQuery;
let lenis = new Lenis();
function getParam(e) {
  return new URL(window.location.href).searchParams.get(e) || "N/A";
}
function formRegister() {
  let l = document.getElementById("form-register");
  if (l) {
    let i = l.querySelector("button[type='submit']"),
      s = l.querySelector("#accept"),
      r = l.querySelectorAll(".field-item input"),
      o = document.querySelector(".message-success");
    (l.querySelector('[name="utm_source"]').value = getParam("utm_source")),
      (l.querySelector('[name="utm_medium"]').value = getParam("utm_medium")),
      (i.disabled = !0),
      s.addEventListener("change", function () {
        i.disabled = !this.checked;
      }),
      l.addEventListener("submit", function (e) {
        e.preventDefault();
        let t = !0;
        l
          .querySelectorAll(".field-item")
          .forEach((e) => e.classList.remove("error")),
          r.forEach((e) => {
            "checkbox" !== e.type &&
              "" === e.value.trim() &&
              (e.closest(".field-item").classList.add("error"), (t = !1));
          }),
          s.checked ||
            (s.closest(".field-item").classList.add("error"), (t = !1)),
          t &&
            (i.classList.add("aloading"),
            (e = new FormData(l)),
            fetch(
              "https://script.google.com/macros/s/AKfycbzJSGh6G7qgh1TkXOkqoXuNJz0M7inCU5n9aD1pmAaAoBqJmxrrXtT3fvKKcOpoMGia/exec",
              { method: "POST", body: e }
            )
              .then((e) => e.json())
              .then((e) => {
                i.classList.remove("aloading"),
                  "success" === e.status &&
                    (l.reset(), (i.disabled = !0), o) &&
                    ((o.style.display = "block"),
                    setTimeout(() => {
                      o.style.display = "none";
                    }, 1e4));
              })
              .catch(() => {
                i.classList.remove("aloading");
              }));
      });
  }
}
lenis.on("scroll", ScrollTrigger.update),
  gsap.ticker.add((e) => {
    lenis.raf(1e3 * e);
  }),
  gsap.ticker.lagSmoothing(0);
let init = () => {
    gsap.registerPlugin(ScrollTrigger), scrollToTop(), formRegister();
  },
  isLinkClicked =
    (preloadImages("img").then(() => {
      init();
    }),
    !1);
$("a").on("click", function (e) {
  !this.href ||
    this.href.match(/^#/) ||
    this.href.match(/^javascript:/) ||
    (isLinkClicked = !0);
}),
  $(window).on("beforeunload", function () {
    isLinkClicked || $(window).scrollTop(0), (isLinkClicked = !1);
  });
