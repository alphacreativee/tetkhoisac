import{preloadImages}from"../../libs/utils.js";import{swiperSong,swiperTickets,scrollToSection,animation,scrollToTop,countdownTimer,header}from"../../js/index/global.js";$=jQuery;let lenis=new Lenis;function getParam(e){return new URL(window.location.href).searchParams.get(e)||"N/A"}function getReferrer(){return document.referrer&&""!==document.referrer?document.referrer:"direct"}function formRegister(){let l=document.getElementById("form-register");if(l){let t=l.querySelector("button[type='submit']"),i=l.querySelector("#accept"),o=l.querySelectorAll(".field-item input"),s=document.querySelector(".message-success");l.querySelector('[name="utm_source"]').value=getParam("utm_source"),l.querySelector('[name="utm_medium"]').value=getParam("utm_medium"),l.querySelector('[name="ref_link"]').value=getReferrer(),console.log("ref_link:",getReferrer()),t.disabled=!0,i.addEventListener("change",function(){t.disabled=!this.checked}),l.addEventListener("submit",function(e){e.preventDefault(),l.querySelector('[name="ref_link"]').value=getReferrer()||"direct";let r=!0;l.querySelectorAll(".field-item").forEach(e=>e.classList.remove("error")),o.forEach(e=>{"checkbox"!==e.type&&""===e.value.trim()&&(e.closest(".field-item").classList.add("error"),r=!1)}),i.checked||(i.closest(".field-item").classList.add("error"),r=!1),r&&(t.classList.add("aloading"),e=new FormData(l),e=new URLSearchParams(e),fetch("https://script.google.com/macros/s/AKfycbzJSGh6G7qgh1TkXOkqoXuNJz0M7inCU5n9aD1pmAaAoBqJmxrrXtT3fvKKcOpoMGia/exec",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e.toString()}).then(e=>e.json()).then(e=>{t.classList.remove("aloading"),"success"===e.status&&(l.reset(),t.disabled=!0,s)&&(s.style.display="block",setTimeout(()=>{s.style.display="none"},1e4))}).catch(()=>{t.classList.remove("aloading")}))})}}function toggleMobileMenu(){if(document.querySelector(".header-hambuger")){var e=document.querySelector(".header-hambuger");let r=document.querySelector(".header-menu"),t=document.querySelector("body");e.addEventListener("click",function(){var e=this.classList.toggle("active");r.classList.toggle("active"),t.classList.toggle("overflow-hidden"),e?window.lenis&&lenis.stop():window.lenis&&lenis.start()})}}lenis.on("scroll",ScrollTrigger.update),gsap.ticker.add(e=>{lenis.raf(1e3*e)}),gsap.ticker.lagSmoothing(0);let init=()=>{gsap.registerPlugin(ScrollTrigger),animation(),formRegister(),swiperSong(),swiperTickets(),scrollToSection(),toggleMobileMenu(),scrollToTop(),header(),countdownTimer()},isLinkClicked=(preloadImages("img").then(()=>{init()}),!1);$("a").on("click",function(e){!this.href||this.href.match(/^#/)||this.href.match(/^javascript:/)||(isLinkClicked=!0)}),$(window).on("beforeunload",function(){isLinkClicked||$(window).scrollTop(0),isLinkClicked=!1});